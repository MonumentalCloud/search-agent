# Search Agent with Server-Sent Events (SSE)

A minimalist implementation of the search agent using Server-Sent Events (SSE) for real-time communication instead of WebSockets.

## Overview

This project provides a search agent that can answer questions based on document content. It uses:

- **Server-Sent Events (SSE)** for real-time communication
- **ChromaDB** for vector storage and retrieval
- **FastAPI** for the backend API
- **Minimalist frontend** inspired by SSense design

## Features

- Real-time search processing updates
- Clean, minimalist UI with black text on white background
- Citation support with source document display
- Conversation history and context

## Getting Started

### Prerequisites

- Python 3.8+
- ChromaDB
- Required Python packages (see `requirements.txt`)

### Installation

1. Clone the repository:
   ```bash
   git clone <repository-url>
   cd search_agent
   ```

2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

3. Set up environment variables:
   ```bash
   cp env.sample .env
   # Edit .env with your configuration
   ```

### Running the Server

1. Start the SSE server:
   ```bash
   python run_sse_server.py
   ```

2. Access the frontend:
   - Open `http://localhost:8000/ssense.html` in your web browser

### Testing

To test the SSE implementation directly:

```bash
python test_sse_client.py "What is in the marketing meeting document?"
```

## Architecture

### Backend Components

- **SSE Server (`apps/api/sse_server.py`)**: Handles SSE connections and streams search results
- **Search Agent (`agent/graph.py`)**: Processes search queries and generates answers
- **ChromaDB Adapter (`adapters/chroma_adapter.py`)**: Interfaces with the vector database

### Frontend Components

- **SSE Client (`frontend/ssense.js`)**: Connects to the SSE endpoint and processes events
- **UI (`frontend/ssense.html`, `frontend/ssense.css`)**: Minimalist interface for the search agent

## SSE vs WebSockets

This implementation uses Server-Sent Events (SSE) instead of WebSockets for several reasons:

1. **Simplicity**: SSE uses standard HTTP, making it easier to implement and deploy
2. **Compatibility**: Better support with HTTP infrastructure (proxies, load balancers)
3. **Automatic Reconnection**: Built-in reconnection handling in the EventSource API
4. **Unidirectional Flow**: Perfect for our use case where updates flow from server to client

For more details, see the [SSE Implementation Documentation](SSE_IMPLEMENTATION.md).

## API Endpoints

### SSE Endpoint

- `GET /sse/agent`: Establishes an SSE connection for receiving real-time updates

### Query Endpoint

- `POST /api/query`: Submits a search query and streams the results
  - Request Body:
    ```json
    {
      "query": "Your question here",
      "query_id": "optional-unique-id",
      "session_id": "optional-session-id"
    }
    ```

## Event Types

1. **connected**: Sent when a client connects to the SSE endpoint
2. **node_update**: Sent when a search agent node updates its status
3. **answer**: Sent when the search agent completes processing a query
4. **error**: Sent when an error occurs during processing

## Customization

### Styling

The frontend uses a minimalist design inspired by SSense. You can customize the appearance by modifying:

- `frontend/ssense.css`: Main stylesheet
- `frontend/ssense.html`: HTML structure

### Processing Display

The frontend displays a summary of the search processing steps. You can customize how these summaries are generated by modifying the `create_node_summary` function in `apps/api/sse_server.py`.

## Troubleshooting

### Connection Issues

If you experience connection issues:

1. Check that the server is running (`python run_sse_server.py`)
2. Verify that port 8000 is available (`lsof -i :8000`)
3. Check the logs in `logs/sse_server.log`

### Browser Compatibility

SSE is supported in all modern browsers. If you experience issues:

1. Try a different browser (Chrome, Firefox, Safari)
2. Check for browser console errors
3. Verify that your browser supports the EventSource API

## License

[Your License Information]

## Acknowledgments

- [FastAPI](https://fastapi.tiangolo.com/)
- [ChromaDB](https://www.trychroma.com/)
- [SSense](https://www.ssense.com/) for design inspiration
